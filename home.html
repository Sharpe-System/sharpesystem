<!-- /home.html -->
<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Home — SharpeSystem</title>
  <link rel="stylesheet" href="/styles.css" />
</head>

<body>
  <!-- Shared header/nav -->
  <div id="site-header"></div>
  <script>
    // Absolute path so it works from subfolders too
    fetch('/partials/header.html')
      .then(r => r.text())
      .then(html => { document.getElementById('site-header').innerHTML = html; })
      .catch(() => {});
  </script>

  <main class="page">
    <div class="container content">

      <section class="page-hero" aria-label="Home hero">
        <h1 data-i18n="home.h1">SharpeSystem</h1>
        <p class="lede" data-i18n="home.sub">
          Procedural orientation and decision support for high-stakes situations.
          Calm, structured, and non-directive — <strong>informational only</strong>.
        </p>

        <div class="cta-row">
          <!-- These get rewritten by script below to preserve ?next= -->
          <a id="ctaLegal" class="button primary" href="/tier1">Sharpe Legal</a>
          <a id="ctaLogin" class="button" href="/login?next=/dashboard">Log in</a>
        </div>

        <div class="link-row">
          <span class="muted" id="nextHint"></span>
        </div>
      </section>

      <div class="hr"></div>

      <section aria-label="Quick links">
        <h2>Quick links</h2>
        <div class="cta-row">
          <a class="button" href="/status">Status</a>
          <a class="button" href="/high-conflict-risk-awareness">Risk Awareness</a>
          <a class="button" href="/binder/attorney-invite">For Attorneys</a>
        </div>
      </section>

    </div>
  </main>

  <!-- If you have i18n, keep it -->
  <script src="/i18n.js"></script>

  <script type="module">
    import { safeNext, getNextParam } from "/safeNext.js";

    // If user was redirected here by app gate, preserve their intended destination.
    // Example: /home?next=/app
    const next = getNextParam("/dashboard");

    // Wire CTAs with next preserved
    const legal = document.getElementById("ctaLegal");
    const login = document.getElementById("ctaLogin");
    const hint  = document.getElementById("nextHint");

    if (legal) {
      // Tier page routes through login anyway, but preserve next for continuity
      // If you prefer: next=/app always, change to "/login?next=/app"
      legal.href = "/tier1?next=" + encodeURIComponent(next);
    }

    if (login) {
      login.href = "/login?next=" + encodeURIComponent(next);
    }

    if (hint && next) {
      hint.textContent = (next && next !== "/dashboard")
        ? `Next preserved: ${safeNext(next, "/dashboard")}`
        : "";
    }
  </script>
</body>
</html>
