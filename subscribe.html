<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Subscribe</title>

  <style>
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background:#0b0f14;
      color:#e8eef6;
      display:flex;
      min-height:100vh;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .card{
      width:100%;
      max-width:520px;
      background:#101826;
      border:1px solid #1b2a3f;
      border-radius:18px;
      padding:22px;
      box-shadow: 0 18px 40px rgba(0,0,0,.35);
    }
    h1{ margin:0 0 8px; font-size:28px; }
    p{ margin:0 0 16px; color:#b6c2d2; line-height:1.35; }
    label{ display:block; font-size:13px; color:#b6c2d2; margin:14px 0 6px; }
    input{
      width:100%;
      box-sizing:border-box;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid #1b2a3f;
      background:#0f1622;
      color:#e8eef6;
      outline:none;
    }
    input:focus{ border-color:#6ee7ff; }
    .row{ display:flex; gap:10px; margin-top:14px; }
    button{
      flex:1;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid #1b2a3f;
      background:#6ee7ff;
      color:#081018;
      font-weight:700;
      cursor:pointer;
    }
    button:disabled{
      opacity:.65;
      cursor:not-allowed;
    }
    .ghost{
      background:#0f1622;
      color:#e8eef6;
    }
    .status{
      margin-top:14px;
      font-size:13px;
      color:#b6c2d2;
      min-height:18px;
      word-break:break-word;
    }
    .ok{ color:#34d399; }
    .bad{ color:#fb7185; }
  </style>
</head>

<body>
  <div class="card">
    <h1>Subscribe</h1>
    <p>Enter your email. We’ll save your request and follow up when this is ready.</p>

    <label for="email">Email</label>
    <input id="email" type="email" autocomplete="email" placeholder="you@example.com" />

    <div class="row">
      <button id="subscribeBtn" type="button">Subscribe</button>
      <button id="backBtn" class="ghost" type="button">Back</button>
    </div>

    <div id="status" class="status"></div>
  </div>

  <script type="module">
    // IMPORTANT: This removes any embedded firebaseConfig/apiKey from subscribe.html.
    // We import the single source of truth from firebase-config.js.
    import app from "/firebase-config.js";

    import {
      getFirestore,
      collection,
      addDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const db = getFirestore(app);

    const emailEl = document.getElementById("email");
    const statusEl = document.getElementById("status");
    const subscribeBtn = document.getElementById("subscribeBtn");
    const backBtn = document.getElementById("backBtn");

    function setStatus(msg, kind="") {
      statusEl.textContent = msg;
      statusEl.className = "status " + kind;
      console.log(msg);
    }

    backBtn.addEventListener("click", () => {
      // Adjust if you want a different destination
      window.location.href = "/index.html";
    });

    subscribeBtn.addEventListener("click", async () => {
      const email = (emailEl.value || "").trim().toLowerCase();

      if (!email || !email.includes("@")) {
        setStatus("Please enter a valid email.", "bad");
        return;
      }

      subscribeBtn.disabled = true;
      setStatus("Saving…");

      try {
        // Collection name is up to you. This one is simple and obvious.
        await addDoc(collection(db, "subscriptions"), {
          email,
          createdAt: serverTimestamp(),
          source: "subscribe.html",
          userAgent: navigator.userAgent
        });

        setStatus("Saved. You’re on the list.", "ok");
        emailEl.value = "";
      } catch (err) {
        console.error(err);
        setStatus("Failed to save: " + (err?.message || err), "bad");
      } finally {
        subscribeBtn.disabled = false;
      }
    });

    setStatus("Ready.");
  </script>
</body>
</html>
